# MSA-Webtoon 吏꾪뻾 ?꾪솴 (湲곕뒫 以묒떖)

蹂?臾몄꽌??README.md? ?꾩옱 ?뚯뒪 援ъ“/肄붾뱶瑜?湲곗??쇰줈 ?꾨즺???묒뾽怨??욎쑝濡?吏꾪뻾???묒뾽??湲곕뒫 愿?먯뿉???뺣━?⑸땲?? 援ъ껜 肄붾뱶 ?몃????ы븿?섏? ?딆뒿?덈떎.

## ?꾨즺???묒뾽

- 紐⑤끂?덊룷/鍮뚮뱶
  - Gradle 硫?곕え??援ъ꽦, 怨듯넻 ?쇱씠釉뚮윭由?踰꾩쟾 移댄깉濡쒓렇 ?곸슜
  - 濡쒖뺄 ?ㅽ뻾/鍮뚮뱶 ?ㅽ겕由쏀듃 諛?湲곕낯 CI ?ㅽ뀅(`ci/Jenkinsfile`)
- 濡쒖뺄 ?명봽??
  - Docker Compose濡?Kafka, Redis, Postgres, OpenSearch, Prometheus, Grafana, Alertmanager 湲곕룞 援ъ꽦(`platform/local`)
  - 湲곕낯 Grafana ?곗씠?곗냼??Prometheus ?ㅽ겕???ㅼ젙, Alertmanager ?듯빀 (severity ?쇱슦??
  - Kafka ?좏뵿 ?앹꽦 ?ㅽ겕由쏀듃, OpenSearch nori ?ㅼ튂 ?ㅽ겕由쏀듃(?먮룞 ?먯?), ?ъ깋???ㅽ겕由쏀듃 異붽?
  - ?먰꽣移?遺?몄뒪?몃옪 ?ㅽ겕由쏀듃 異붽?(Compose up ???좏뵿 ?앹꽦 ??nori ?ㅼ튂)
  - Grafana ??쒕낫???먮룞 ?꾨줈鍮꾩???"MSA Overview", "Search & Rank" - ?됱씤 硫뷀듃由??⑤꼸 ?ы븿)
  - Prometheus Alert Rules: 5xx, 429, /search p95, CB open, DLQ, Backpressure, Search ?됱씤 ?ㅽ뙣/吏??
- API Gateway (Spring Cloud Gateway)
  - ?쒕퉬???쇱슦??`/ingest/**`, `/rank/**`, `/catalog/**`, `/search/**`, `/generator/**`)
  - Redis 湲곕컲 ?덉씠?몃━諛? CORS, Request ID/Access Log ?꾪꽣, OpenAPI ?ㅼ젙
  - JWT ?곗퐫??諛??ㅼ퐫??湲곕컲 ?묎렐 ?듭젣 ?ㅼ젙(寃뚯씠?몄썾???덈꺼)
  - ?뚮났?꾨젰?? Circuit Breaker + Retry + TimeLimiter ?곸슜, ?대갚 而⑦듃濡ㅻ윭 ?곕룞, 湲濡쒕쾶 JSON ?ㅻ쪟 ?묐떟 ?쒖???
  - CORS 寃쎈줈蹂??뺤콉 ?곸슜, ?덉씠?몃━諛?429) 硫뷀듃由?諛???쒕낫??諛섏쁺
- Event Ingest ?쒕퉬??
  - ?대깽???섏쭛 ?붾뱶?ъ씤?? ?④굔/諛곗튂(POST `/ingest/events`, `/ingest/events/batch`)
  - Kafka `events.page_view.v1` 諛쒗뻾, ?낅젰 ?좏슚??寃利?
  - Actuator/Prometheus ?몄텧
  - DLQ(Dead Letter Queue) 援ы쁽 諛??ъ쿂由?濡쒖쭅 ?꾨즺(DlqConsumerService, DlqReprocessService, DlqController)
  - 諛곗븬(Backpressure) 泥섎━: Semaphore 湲곕컲 ?숈떆???쒖뼱 ?꾨즺
  - Kafka ?꾨줈????ъ떆??媛뺥솕: 臾댁젣???ъ떆??理쒕? 2遺???꾩븘?? + DLQ ?대갚
- Rank ?쒕퉬??
  - Kafka Streams ?덈룄??吏묎퀎(珥??⑥쐞 ?ㅼ젙 媛? ?? 10s/60s/300s)
  - 吏묎퀎 寃곌낵瑜?Redis ZSET??諛섏쁺, ?곸쐞 ??궧 議고쉶 API ?쒓났
    - `GET /rank/top`, `GET /rank/top/detail`
  - 泥섎━/?ㅻ쪟 硫뷀듃由?怨꾩륫
  - ??궧 ??TTL(?ㅼ젙 湲곕컲) ?곸슜 諛??덉슜 ?덈룄??寃利앹쓣 ?ㅼ젙媛믪쑝濡??쇱썝??
  - ?щ씪?대뵫 ?⑷퀎 ?듭뀡(aggregate) 異붽? 諛??묐떟 硫뷀??곗씠???ㅻ뜑(X-Window, X-Aggregate, X-Aggregate-ReadFactor, X-Window-Seconds, X-Aggregate-Start-Ms/End-Ms) ?ы븿
- Catalog ?쒕퉬??
  - `POST /catalog/upsert`濡?移댄깉濡쒓렇 upsert ??Postgres ???+ Kafka `catalog.upsert.v1` 諛쒗뻾
  - `GET /catalog/{id}` ?④굔 議고쉶
  - Flyway 留덉씠洹몃젅?댁뀡: V1 (珥덇린 ?ㅽ궎留?, V2 (4媛??몃뜳??+ version 而щ읆 異붽?)
  - Optimistic Locking: version 湲곕컲 ?숈떆???쒖뼱, UPDATE ???먮룞 利앷?
  - ?듯빀 ?뚯뒪?? 踰꾩쟾 利앷? 寃利? ?숈떆 upsert ?뚯뒪??
- Search ?쒕퉬??
  - `catalog.upsert.v1` 而⑥뒛?섏뿬 OpenSearch ?됱씤, ?몃뜳??遺?몄뒪?몃옪(?놁쑝硫??앹꽦)
  - ?ㅼ썙??寃??API(`GET /search?q=...&size=...`), 硫???꾨뱶 留ㅼ묶
  - ?몃뜳???ㅼ젙/留ㅽ븨 怨좊룄??nori+edge n-gram+?숈쓽??, ?섏씠?쇱씠???듭뀡 異붽?
  - Alias ?꾪솚 ?ㅽ겕由쏀듃 ?쒓났(臾댁쨷???몃뜳??援먯껜)
  - @RetryableTopic ?곸슜: 3???ъ떆??+ exponential backoff, DLT ?꾩넚
  - 硫뷀듃由?異붽?: search_index_failure, search_index_latency
  - DLT ?몃뱾?? ?곴뎄 ?ㅽ뙣 ?대깽??濡쒓퉭 諛?硫뷀듃由?湲곕줉
  - Grafana ??쒕낫???⑤꼸 異붽?: ?됱씤 ?ㅽ뙣?? 吏?? DLT ?좎엯
  - (?꾨즺) 怨좉툒 ?뚯뒪?? ?숈쓽??湲곕컲 寃??+ ?섏씠?쇱씠??諛섑솚 寃利?
- Event Generator (遺???곕え)
  - ?대깽???앹꽦 ?쒖옉/以묒?/?곹깭 API(`POST /generator/start|stop`, `GET /generator/status`)
  - EPS 議곗젅, ?앹꽦/諛쒗뻾/?먮윭 硫뷀듃由?吏묎퀎, Kafka 諛쒗뻾
- ?몄쬆(珥덇린)
  - RS256 + JWKS 湲곕컲?쇰줈 ?꾪솚, Access/Refresh ?좏겙 諛쒓툒 諛?媛깆떊(`/token`, `/token/refresh`), ??濡ㅻ쭅 ?붾뱶?ъ씤??`/keys/rotate`)
- ?ㅽ궎留?臾몄꽌
  - JSON ?ㅽ궎留??섑뵆(`schemas/json/*`), README???몄텧 ?덉떆/鍮좊Ⅸ ?쒖옉/濡쒕뱶留??섎줉
  - ?먯긽???꾪궎?띿쿂 臾몄꽌 ?泥대낯(`docs/architecture-fixed.md`) 異붽?, README 留곹겕/媛?대뱶 蹂닿컯
  - ?ㅼ퐫???좏겙 媛?대뱶(`docs/auth-and-scopes.md`), ?좏겙/?덉젣 ?몄텧 ?ㅽ겕由쏀듃 異붽?

## ?욎쑝濡?吏꾪뻾???묒뾽

- API Gateway/蹂댁븞
  - ?쇰? ?쇰툝由??덉슜 ?쇱슦???뺢탳?? ?ㅼ퐫???뺤콉 ?먭?(蹂댁셿)
- ?몄쬆/沅뚰븳
  - Auth ?쒕퉬??湲곕뒫 ?뺤옣: 濡쒓렇??沅뚰븳 ?ㅼ퐫??紐⑤뜽留??⑥쓬)
  - ?댁쁺 ??愿由??뺤콉/?좏겙 寃利??꾨왂 ?뺢탳???⑥쓬)
- Event Ingest
  - (?꾨즺) DLQ 援ы쁽 諛??ъ쿂由?濡쒖쭅: 10媛?API ?붾뱶?ъ씤??議고쉶/?뱀씤/?ъ쿂由??듦퀎/?뺣━)
  - (?꾨즺) 諛곗븬/?띾룄 ?쒖뼱: Semaphore 湲곕컲(理쒕? 1000 ?숈떆 泥섎━)
  - (?꾨즺) ?꾨줈????ъ떆??媛뺥솕: 臾댁젣???ъ떆??+ DLQ ?대갚
  - ?ㅽ궎留??좏슚??媛뺥솕, ??⑸웾 諛곗튂 理쒖쟻??
  - 硫깅벑???듭뀡/?꾩넚 蹂댁옣 ?쒕떇
- Rank ?쒕퉬??
  - ?뺥솗???쒕쾲 泥섎━/由щ갭?곗떛 ??? ?щ씪?대뵫 李?吏묎퀎 ?꾨왂) 怨좊룄??
  - ??궧 ???ㅺ퀎/留뚮즺/諛깃렇?쇱슫???뺣━, ??궧 湲곗? ?ㅻ???酉?醫뗭븘????
- Catalog ?쒕퉬??
  - ??(?꾨즺) ?몃뜳??理쒖쟻?? Flyway V2 留덉씠洹몃젅?댁뀡?쇰줈 4媛??몃뜳??異붽? (title, tags GIN, updated_at, version)
  - ??(?꾨즺) Optimistic Locking: version 而щ읆 湲곕컲 ?숈떆???쒖뼱 援ы쁽
  - ??(?꾨즺) DB 寃쏀빀/?몃옖??뀡 ?뚯뒪?? ?섎せ??upsert ??濡ㅻ갚/誘몄깮??寃利? ?숈떆??耳?댁뒪 蹂댁셿, 踰꾩쟾 利앷? 寃利??뚯뒪??異붽?
  - ?곗씠??紐⑤뜽 ?뺤옣(移댄뀒怨좊━/?묒꽦????, ?몃옖??뀡 寃쏀빀 泥섎━ 怨좊룄??
- Search ?쒕퉬??
  - ??(?꾨즺) @RetryableTopic: 3???ъ떆??+ exponential backoff, DLT ?꾩넚 (catalog.upsert.v1.dlt)
  - ??(?꾨즺) 硫뷀듃由?異붽?: search_index_failure (DLT), search_index_latency (Timer)
  - ??(?꾨즺) DLT ?몃뱾?? ?곴뎄 ?ㅽ뙣 ?대깽??濡쒓퉭 諛?硫뷀듃由?湲곕줉
  - ??(?꾨즺) Grafana ??쒕낫??"Search & Rank": ?됱씤 硫뷀듃由??⑤꼸 異붽? (?ㅽ뙣?? 吏?? DLT ?좎엯)
  - 寃???덉쭏 ?쒕떇(?ъ쟾/?숈쓽???뺤옣, ?섏씠?쇱씠???덉쭏), ?섏씠吏?ㅼ씠???꾨왂 怨좊룄??
  - ?ъ깋??諛깊븘 ?뚯씠?꾨씪???먮룞??諛?alias ?꾪솚(怨좊룄??, ?몃뜳???섎챸二쇨린 ?뺤콉(ILM)
- Event Generator
  - ?쒕굹由ъ삤 ?꾨━???멸린 ?명뼢, 踰꾩뒪???쇳겕, ?ъ슜??援곗쭛), ?ㅼ쨷 ?좏뵿 吏??
  - 紐⑺몴 QPS 蹂댁옣/?ㅼ?以꾨쭅 媛쒖꽑, 硫???몄뒪?댁뒪 ?뺤옣
- 愿痢≪꽦
  - ??(?꾨즺) Grafana ??쒕낫?? "MSA Overview", "Search & Rank" (?됱씤 硫뷀듃由??⑤꼸 ?ы븿)
  - ??(?꾨즺) Prometheus Alert Rules: 湲곗〈 (5xx, 429, /search p95, CB open) + ?좉퇋 (DLQ, Backpressure, Search ?됱씤 ?ㅽ뙣/吏??
  - ??(?꾨즺) Alertmanager ?듯빀: docker-compose 異붽?, severity 湲곕컲 ?쇱슦???ㅼ젙
  - OpenTelemetry ?꾩엯 諛?遺꾩궛 ?몃젅?댁떛(寃뚯씠?몄썾?닳넂?쒕퉬?? + Tempo
  - 濡쒓렇 ?ㅽ깮(Loki) ?듯빀, 肄붾┫?덉씠??ID ?꾪뙆 ?쇨???
  - SLO/?먮윭踰꾩쭞 ?댁쁺 ?뺣┰
- ?명봽??諛고룷
  - (?꾨즺) Helm 李⑦듃 ?꾩껜 ?묒꽦: 8媛??쒕퉬??(api-gateway, auth-service, catalog-service, event-generator, event-ingest, rank-service, search-service) + common ?쇱씠釉뚮윭由?李⑦듃
  - (?꾨즺) ?섍꼍蹂?values ?뚯씪: dev/prod (由ъ냼??濡쒓퉭/?ㅼ??쇰쭅 李⑤퀎??
  - (?꾨즺) Jib ?대?吏 鍮뚮뱶 ?ㅼ젙: 紐⑤뱺 ?쒕퉬?ㅼ뿉 Jib ?뚮윭洹몄씤 ?듭씪 ?곸슜
  - (?꾨즺) Jenkinsfile CI/CD ?뚯씠?꾨씪?? 8媛??쒕퉬??蹂묐젹 鍮뚮뱶, ?뚯뒪??由ы룷?? K8s ?먮룞 諛고룷 (main 釉뚮옖移?
  - (?꾨즺) Docker Registry ?곕룞: setup-registry-secret ?ㅽ겕由쏀듃 (sh/ps1), imagePullSecrets 援ъ꽦
  - (?꾨즺) K8s 諛고룷 ?ㅽ겕由쏀듃: deploy-all/undeploy-all (sh/ps1) - ?섍꼍蹂??쇨큵 諛고룷/??젣
  - (?꾨즺) K8s 諛고룷 媛?대뱶: platform/k8s/README.md (Docker Hub/GHCR/Private Registry ?ㅼ젙, 濡쒖뺄/?꾨줈?뺤뀡 諛고룷 媛?대뱶)
  - (吏꾪뻾) K8s 濡쒖뺄 諛고룷 ?뚯뒪??諛?李⑦듃 寃利?(minikube/k3s)
  - Argo CD(3?④퀎) GitOps, ?쒗겕由?援ъ꽦 ?몃? 愿由?Sealed Secrets/External Secrets)
  - 濡쒖뺄 Compose 異붽? 媛쒖꽑 ?ы빆(?꾩슂 ?? 諛?媛쒕컻??UX ?μ긽
- ?곗씠???ㅽ궎留?嫄곕쾭?뚯뒪
  - ?ㅽ궎留??덉??ㅽ듃由??명솚??猷? 踰꾩????꾨왂
  - ?곗씠??蹂댁〈/?뺣━ ?뺤콉, 媛쒖씤?뺣낫/而댄뵆?쇱씠?몄뒪 寃??
- ?덉쭏/?뚯뒪??
  - Testcontainers 湲곕컲 ?듯빀 ?뚯뒪?? E2E ?ㅽ겕由쏀듃 ?곕룞 ?덉젙??
  - (?꾨즺) E2E ?ㅻえ???ㅽ겕由쏀듃 異붽?(ps1/sh): ?좏겙?믪뭅?덈줈洹멤넂?대깽?멤넂??궧/寃??寃利?
  - (吏꾪뻾) 肄붾뱶 湲곕컲 ?듯빀 ?뚯뒪???꾩엯(JUnit5 + Testcontainers)
    - (?꾨즺) rank-service: Kafka/Redis/JWKS 紐⑦궧?쇰줈 ?덈룄??吏묎퀎/議고쉶 寃利?
    - (?꾨즺) event-ingest: Kafka/JWKS 紐⑦궧?쇰줈 諛쒗뻾 ?깃났 寃利?
    - (?꾨즺) search-service: OpenSearch/Kafka/JWKS濡??됱씤?믨????뚮줈??寃利??뚯뒪???꾩슜 留ㅽ븨)
    - (?꾨즺) catalog-service: 蹂댁븞 ?곸슜 ?섏뿉 RS256 ?좏겙 ?ы븿 upsert ?깃났 寃利?
    - (吏꾪뻾) api-gateway: ?뚮났?꾨젰??CB/Retry/TimeLimiter) ?대갚, CORS ?ъ쟾?붿껌 ?뚯뒪??429 硫뷀듃由?? 異뷀썑 ?덉젙????異붽?)
  - (?꾨즺) 而ㅻ쾭由ъ? 由ы룷???붿빟 ?ㅽ겕由쏀듃 ?뺣━(coverage_report.py), README???ъ슜踰?異붽?
  - ?깅뒫/遺???뚯뒪???꾨줈?뚯씪, 移대굹由??곌린 ?뚯뒪??
- ?꾨윴?몄뿏???곕え
  - Demo UI(2?④퀎 濡쒕뱶留?, ?ㅼ떆媛???궧/寃????쒕낫??援ы쁽
- 臾몄꽌??
  - (?꾨즺) ?먯긽??`docs/architecture.md` 蹂듦뎄: 理쒖떊 援ы쁽 ?곹깭 諛섏쁺
  - (?꾨즺) Auth ?ㅼ퐫??留ㅽ븨 臾몄꽌: `docs/auth-scope-mapping.md` 異붽?
  - (?꾨즺) README.md ?낅뜲?댄듃: DLQ, Helm, Circuit Breaker ?꾨즺 ?곹깭 諛섏쁺
  - ?댁쁺 媛?대뱶/?곕턿/?μ븷 ????뚮줈??異붽?

## 李멸퀬(濡쒕뱶留?留ㅽ븨)

- 1?④퀎: ingest ??rank ??gateway ??catalog ??search(?듭떖 湲곕뒫) [?遺遺?援ы쁽 ?꾨즺]
- 2?④퀎: event-generator(援ы쁽) + demo-frontend, batch-sync, Loki/Tempo/OTel [?곸슜 吏꾪뻾]
- 3?④퀎: event-replayer, chaos-injector, notification, Argo CD, Service Mesh [異붽? ?덉젙]

## ?쒕퉬?ㅻ퀎 ?곗꽑?쒖쐞/留덉씪?ㅽ넠

?꾨옒 ?곗꽑?쒖쐞??Now(利됱떆), Next(?ㅼ쓬), Later(異뷀썑)濡?援щ텇?덉뒿?덈떎. 留덉씪?ㅽ넠? M1(肄붿뼱 ?곕え), M2(?댁쁺???곕え 怨좊룄??, M3(?꾨줈?뺤뀡 以鍮?濡??섎닏?덈떎.

### API Gateway
- Now
- Next
  - 寃쎈줈/?ㅼ퐫??留ㅽ븨 ?쒖??? ?쇱슦???ъ뒪 泥댄겕 媛뺥솕(M2)
- Later
  - Canary/Blue-Green ?쇱슦???⑦꽩, ?쒗궥 釉뚮젅?댁빱 ??쒕낫??M3)

### Auth Service
- Now
  - ?좏겙 諛쒓툒 ?ㅽ럺 ?뺣━(?ㅼ퐫??留뚮즺/??愿由? 諛?寃뚯씠?몄썾???쒕퉬???뺥빀???먭?(M1)
- Next
  - 濡쒓렇??由ы봽?덉떆/??濡ㅻ쭅, 怨듦컻??諛고룷 ?붾뱶?ъ씤??M2)
- Later
  - ?ъ슜????븷 紐⑤뜽, 沅뚰븳 媛먯궗 濡쒓퉭/寃쎈낫(M3)

### Event Ingest
- Now
  - (?꾨즺) DLQ/?ъ쿂由?寃쎈줈: ?꾩쟾???뚰겕?뚮줈??PENDING?묨PPROVED?뭃EPROCESSED)
  - (?꾨즺) 諛곗븬 泥섎━: Semaphore 湲곕컲 ?숈떆???쒖뼱
  - (?꾨즺) 湲곕낯 ?ъ떆??媛뺥솕: 臾댁젣???ъ떆??+ DLQ ?대갚
  - ?ㅽ궎留??좏슚??媛뺥솕, 諛곗튂 泥섎━ 理쒖쟻??M1)
- Next
  - 硫깅벑 ?꾨줈????꾩넚 蹂댁옣 ?쒕떇(M2)
- Later
  - 珥덇퀬EPS 援ш컙 ?쒕떇, ?띾룄 ?쒖뼱 API/?좊떦??M3)

### Rank Service
- Now
  - (?꾨즺) 1李??쒕떇: ?덈룄?곕떦 ?쎄린 鍮꾩쑉 `rank.aggregateReadFactor` ?꾩엯(M1)
- Next
  - 由щ갭?곗떛/?ъ떆???닿뎄?? ?뺥솗???쒕쾲 泥섎━ ?꾨왂 蹂닿컯(M2)
- Later
  - 吏??湲곕컲 ?먮룞 ?덈룄???곷㈃ ?뺤옣, ?ㅼ뼇????궧 吏??酉?醫뗭븘??泥대쪟)(M3)

### Catalog Service
- Now
  - ??(?꾨즺) ?몃뜳??理쒖쟻?? Flyway V2 留덉씠洹몃젅?댁뀡?쇰줈 4媛??몃뜳??異붽?(title, tags GIN, updated_at, version)(M1)
  - ??(?꾨즺) Optimistic Locking: version 而щ읆 湲곕컲 ?숈떆???쒖뼱, UPDATE ???먮룞 利앷?(M1)
  - ??(?꾨즺) ?듯빀 ?뚯뒪?? 踰꾩쟾 利앷? 寃利? ?숈떆 upsert ?뚯뒪??媛뺥솕(M1)
- Next
  - 紐⑤뜽 ?뺤옣(移댄뀒怨좊━/?묒꽦??, ?몃옖??뀡 寃쏀빀 泥섎━ 怨좊룄??M2)
- Later
  - ?곗씠???쇱씠?꾩궗?댄겢/蹂댁〈 ?뺤콉, 媛먯궗/蹂寃??대젰(M3)

### Search Service
- Now
  - ??(?꾨즺) @RetryableTopic: 3???ъ떆??+ exponential backoff, DLT ?꾩넚(catalog.upsert.v1.dlt)(M1)
  - ??(?꾨즺) 硫뷀듃由?異붽?: search_index_failure(DLT), search_index_latency(Timer)(M1)
  - ??(?꾨즺) DLT ?몃뱾?? ?곴뎄 ?ㅽ뙣 ?대깽??濡쒓퉭 諛?硫뷀듃由?湲곕줉(M1)
  - ??(?꾨즺) Grafana ??쒕낫?? ?됱씤 硫뷀듃由??⑤꼸 異붽?(?ㅽ뙣?? 吏?? DLT ?좎엯)(M1)
- Next
  - ?숈쓽???ъ쟾 ?뺤옣, ?섏씠?쇱씠???덉쭏 媛쒖꽑, ?섏씠吏?ㅼ씠???꾨왂(M2)
- Later
  - ?ъ깋???뚯씠?꾨씪??諛깊븘, ILM/濡ㅼ삤踰??ㅻ깄??M3)

### Event Generator
- Now
  - 紐⑺몴 EPS 蹂댁옣(?ㅼ?以꾨쭅 ?덉젙??, ?곹깭 吏??蹂닿컯(M1)
- Next
  - ?쒕굹由ъ삤 ?꾨━??踰꾩뒪???명뼢), ?ㅼ쨷 ?좏뵿/?ㅽ궎留?吏??M2)
- Later
  - 硫???몄뒪?댁뒪/遺꾩궛 ?쒖뼱, ?κ린 由ы뵆?덉씠 紐⑤뱶(M3)

### Observability
- Now
  - ??(?꾨즺) ??쒕낫??湲곕낯 援ъ꽦: "MSA Overview", "Search & Rank" (?됱씤 硫뷀듃由??⑤꼸 ?ы븿)(M1)
  - ??(?꾨즺) Prometheus Alert Rules: DLQ, Backpressure, Search ?됱씤 ?ㅽ뙣/吏???뚮┝ 異붽?(M1)
  - ??(?꾨즺) Alertmanager ?듯빀: Severity ?쇱슦?? Slack/?대찓???ㅼ젙 媛??M1)
- Next
  - OTel + Tempo ?몃젅?댁떛, Loki 濡쒓렇 ?섏쭛/肄붾┫?덉씠??M2)
- Later
  - SLO/?먮윭踰꾩쭞 ?댁쁺, 洹쇰낯?먯씤 遺꾩꽍 酉?M3)

### Platform/Infra
- Now
  - ??(?꾨즺) Helm 李⑦듃 ?꾩껜 ?묒꽦: 8媛??쒕퉬??+ common ?쇱씠釉뚮윭由?
  - ??(?꾨즺) ?섍꼍蹂?values 遺꾨━: dev/prod ?ㅼ젙 ?꾨즺
  - ??(?꾨즺) Jib ?대?吏 鍮뚮뱶: 紐⑤뱺 ?쒕퉬???듭씪 援ъ꽦
  - ??(?꾨즺) Jenkinsfile CI/CD: 蹂묐젹 鍮뚮뱶, ?뚯뒪??由ы룷?? K8s ?먮룞 諛고룷
  - ??(?꾨즺) Docker Registry ?곕룞: Secret ?ㅽ겕由쏀듃, 諛고룷 媛?대뱶 ?묒꽦
  - ??(?꾨즺) K8s 諛고룷 ?ㅽ겕由쏀듃: deploy-all/undeploy-all (?섍꼍蹂??쇨큵 諛고룷)
  - (吏꾪뻾) K8s 濡쒖뺄 諛고룷 ?뚯뒪??minikube/k3s)
- Next
  - ?쒗겕由??몃? 愿由?Sealed Secrets/External Secrets)(M2)
- Later
  - Argo CD GitOps, Service Mesh/?몃옒???뺤콉(M3)

### 臾몄꽌/嫄곕쾭?뚯뒪
- Now
  - (?꾨즺) `docs/architecture.md` 蹂듦뎄/理쒖떊?? ?꾩쟾???ъ옉??
  - (?꾨즺) `docs/auth-scope-mapping.md` 異붽?: RS256/JWKS ?곸꽭 媛?대뱶
  - (?꾨즺) README.md 理쒖떊?? ?꾨즺??湲곕뒫(DLQ, Helm, Circuit Breaker) 諛섏쁺
  - ?댁쁺 媛?대뱶 珥덉븞 ?묒꽦(M1)
- Next
  - ?ㅽ궎留??덉??ㅽ듃由??명솚??洹쒖튃, 踰꾩????뺤콉(M2)
- Later
  - ?곗씠??蹂댁븞/而댄뵆?쇱씠?몄뒪 媛?대뱶, ?μ븷 ????곕턿 怨좊룄??M3)

## 留덉씪?ㅽ넠 ?뺤쓽(?붿빟)
- M1 肄붿뼱 ?곕え: ingest?뭨ank?뭩earch 寃쎈줈 ?곕え, 湲곕낯 蹂댁븞/愿痢≪꽦, CI 鍮뚮뱶/濡쒖뺄 ?ㅽ뻾 ?덉젙??
- M2 ?댁쁺???곕え 怨좊룄?? generator ?쒕굹由ъ삤, OTel/Loki/Tempo, Helm+K8s, 寃??怨좊룄?? Auth ?뺤옣
- M3 ?꾨줈?뺤뀡 以鍮? GitOps, 蹂듭썝???깅뒫 ?쒕떇, ?곗씠??嫄곕쾭?뚯뒪/ILM, 怨좉툒 ?쇱슦??硫붿떆

---

## 異붿쿇 ?ㅼ쓬 ?묒뾽 (?곗꽑?쒖쐞蹂?

### ?뵶 ?곗꽑?쒖쐞 1: K8s 濡쒖뺄 諛고룷 ?뚯뒪??(2-4?쒓컙)
**紐⑺몴**: Helm 李⑦듃 ?ㅼ젣 ?숈옉 寃利?

**?묒뾽**:
1. minikube ?먮뒗 k3s ?ㅼ튂
   ```bash
   # Windows
   choco install minikube kubernetes-helm
   minikube start --driver=docker
   ```
2. Helm 李⑦듃 寃利?
   ```bash
   helm lint ./platform/helm/charts/api-gateway
   helm install test ./platform/helm/charts/api-gateway --dry-run --debug
   ```
3. ?ㅼ젣 諛고룷 諛??뚯뒪??
   ```bash
   kubectl create namespace msa-webtoon-test
   helm install api-gateway ./platform/helm/charts/api-gateway \
     --namespace msa-webtoon-test --values ./platform/helm/charts/api-gateway/values-dev.yaml
   kubectl get pods -n msa-webtoon-test
   ```

### ??~~?곗꽑?쒖쐞 2: CI/CD ?뚯씠?꾨씪???뺤옣~~ (?꾨즺)
**紐⑺몴**: 紐⑤뱺 ?쒕퉬???먮룞 ?대?吏 鍮뚮뱶

**?꾨즺 ?ы빆**:
- ??Jenkinsfile ?섏젙: 8媛??쒕퉬??紐⑤몢 Jib 蹂묐젹 鍮뚮뱶 援ъ꽦
- ??Docker Registry ?곕룞: setup-registry-secret ?ㅽ겕由쏀듃 (sh/ps1) ?쒓났
- ??Helm values ?대?吏 寃쎈줈: 紐⑤뱺 李⑦듃???듭씪??援ъ“ ?곸슜
- ??K8s 諛고룷 ?먮룞?? deploy-all/undeploy-all ?ㅽ겕由쏀듃 (?섍꼍蹂??쇨큵 諛고룷)
- ??諛고룷 媛?대뱶: platform/k8s/README.md (Docker Hub/GHCR/Private Registry ?ㅼ젙 媛?대뱶)

**?④낵**: ?먮룞?붾맂 鍮뚮뱶, ?쇨???踰꾩쟾 愿由? K8s 諛고룷 湲곕컲 ?꾩꽦

### ?윟 ?곗꽑?쒖쐞 3: OpenTelemetry ?꾩엯 (1-2??
**紐⑺몴**: 寃뚯씠?몄썾?닳넂?쒕퉬???꾩껜 遺꾩궛 ?몃젅?댁떛

**?묒뾽**:
1. OTel Java Agent 異붽? (媛??쒕퉬??Dockerfile)
2. Tempo 異붽? (docker-compose.yml)
3. Grafana-Tempo ?곕룞
4. Trace ID 濡쒓렇 ?ы븿

**?④낵**: ?붿껌 ?먮쫫 ?꾩쟾 媛?쒗솕, 蹂묐ぉ 吏???앸퀎, ?붾쾭源??⑥쑉 ?μ긽

### ?뵷 ?곗꽑?쒖쐞 4: Event Generator ?쒕굹由ъ삤 ?꾨━??(6-8?쒓컙)
**紐⑺몴**: ?ㅼ뼇??遺???⑦꽩 ?뚯뒪??

**?묒뾽**:
- ?쒕굹由ъ삤 ?뺤쓽: NORMAL, BURST, POPULAR_BIAS, RANDOM_SPIKE
- API ?붾뱶?ъ씤??異붽?: `POST /generator/start?scenario=BURST&eps=1000`

**?④낵**: ?꾩떎?곸씤 遺???뚯뒪?? ??궧 ?뚭퀬由ъ쬁 寃利? ?깅뒫 蹂묐ぉ 諛쒓껄

### ?뮕 Quick Wins (利됱떆 媛??
1. **Helm Lint ?ㅽ뻾** (10遺?: 7媛?李⑦듃 寃利?
2. **Docker ?명봽??湲곕룞 ???꾩껜 ?뚯뒪??* (30遺?:
   ```bash
   cd platform/local && docker-compose up -d
   ./gradlew clean test jacocoTestReport --continue
   python coverage_report.py
   ```
3. **Grafana Alert Rule ?뚯뒪??* (15遺?: ?뚮┝ ?몃━嫄?寃利?


## 오늘 변경 사항 (2025-10-21)

- API Gateway
  - 테스트 안정화: 테스트용 JWT 디코더 구성(@TestConfiguration)으로 명시적 임포트 시 항상 주입되도록 정리
  - CORS 테스트 설정을 Spring 프로퍼티 기반으로 정리하여 DynamicPropertySource와 일치
  - 상태: 게이트웨이 단위/통합 테스트 통과

- Search Service
  - OpenSearch Testcontainers 튜닝: 힙 256m, 데모 보안 비활성화, 호환성 플래그 추가, 프로퍼티 키 `opensearch.url` 통일
  - WireMock 의존성 `wiremock-jre8-standalone` 사용으로 제티 클래스 누락 이슈 해결, `javax.servlet-api` 테스트 의존성 추가
  - 테스트 보안/파싱 정리: 관리 보안 오토컨피그 제외, 컨트롤러 응답 타입(Map) 정합화, 인덱스 미존재(404)는 빈 결과 반환
  - 동의어/하이라이트 IT 안정화: ASCII 동의어(comic/cartoon) 사용으로 인코딩 플래키니스 제거
  - 상태: 서치 모듈 테스트 통과

- Catalog Service
  - DB 초기화 전략 변경: 테스트에서 Postgres 15 Testcontainers + `schema.sql` 초기화 사용, Flyway 비활성화
  - 보안/컨트롤러 테스트: MVC 보안 필터 비활성화(@AutoConfigureMockMvc addFilters=false), 보안/트랜잭션 IT에 DB 컨테이너/프로퍼티 주입 추가
  - 상태: 카탈로그 모듈 테스트 통과

- Rank Service
  - E2E 안정화 시도: Streams `state.dir`을 `${java.io.tmpdir}` 기반으로 변경(Windows 경로 이슈 회피), 역직렬화 에러 LogAndContinue, 테스트 시작 시 토픽 사전 생성, 폴링 대기시간 확장
  - 상태: E2E 1건이 환경(Windows Docker/네트워킹) 영향으로 간헐 실패, 추가 설정 보강 예정

- 공통
  - 모듈별 변경은 독립 커밋으로 정리/반영 완료

### 다음 액션(제안)
- Rank E2E 안정화 추가 보강
  - Streams 연결 설정 보강(retries/backoff/request.timeout 등) 및 브로커 준비 대기 로직 강화
  - 필요 시 EmbeddedKafka 도입 또는 Windows 환경 한정 E2E 비활성화 검토
